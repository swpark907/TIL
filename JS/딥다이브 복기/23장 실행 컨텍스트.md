## 실행 컨텍스트

**식별자를 등록하고 관리하는 스코프와 코드 실행 순서 관리를 구현한 내부 메커니즘, 모든 코드는 실행 컨텍스트를 통해 실행되고 관리된다.**

실행 컨텍스트를 이해하면

- JS가 식별자에 바인딩 된 값을 관리하는 방식
- 호이스팅 발생 이유
- 클로저의 동작방식
- 태스크 큐와 함께 동작하는 이벤트 핸들러
- 비동기 처리방식

을 이해할 수 있음

ECMAScript 사양에서의 소스코드

- 전역코드
- 함수코드
- eval 코드
- 모듈 코드

소스코드를 나누는 이유는 이 타입에 따라 실행 컨택스트 생성 과정과 관리가 다르기 때문

## 소스코드 평가, 실행

자바스크립트는 실행 전에 소스코드 평가, 실행 두가지 과정으로 나누어져 있음.

**평가과정**에서 실행 컨텍스트를 생성함 → 변수, 식별자를 키로 스코프에 등록함

평가과정이 끝나고 **실행과정**에서 코드가 순차적으로 실행됨. → 런타임

예제

```jsx
const x = 1;
function foo () {
	const y = 2;

	function bar() {
		const z = 3;
		console.log(x + y + z);
	}
	bar();
}

foo(); // 6
```

실행 컨텍스트는 스택으로 관리됨.

위 예제 코드의 실행 컨텍스트 과정은 전역 코드 평가와 실행, foo 함수 코드 평가와 실행, bar 함수 코드 평가와 실행 으로 나눠볼 수 있음

실행컨텍스트는 두 가지로 분류하여 관리되고 있음.

1. 실행 컨텍스트 스택
2. 렉시컬 환경

## 실행 컨텍스트 과정을 알아보자

```jsx
var x = 1;
const y = 2;

function foo(a) {
  var x = 3;
  const y = 4;

  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z);
  }
  bar(10);
}

foo(20);
```

### 전역객체 생성

전역객체는 전역코드를 평가하기 전에 생성됨.

이는 빌트인 전역 프로퍼티와 전역 함수, 동작 환경에 따른  호스트 객체를 포함함.

전역객체 또한 Object.prototype을 상속함.

### 전역 코드 평가

다음과 같은 순서로 진행됨

1. 전역 실행 컨텍스트 생성
2. 전역 렉시컬 환경 생성
    1. 전역 환경 레코드 생성
        1. 객체 환경 레코드 생성
        2. 선언적 환경 레코드 생성
    2. this 바인딩
    3. 외부 렉시컬 환경에 대한 참조 결정

## 실행 컨텍스트와 블록 레벨 스코프

var는 함수 레벨 스코프

let, const 는 블록 레벨 스코프임

let과 const에서의 스코프는 기존의 것과 다르기 때문에 블록 레벨(if, for, while, try/catch 등)을 만나게 된다면 선언적 환경 레코드를 갖는 렉시컬 환경을 따로 설정해야 한다.

코드에서 블록 레벨 을 만나면 Block Lexical Environment 를 생성하고 선언적 환경 레코드를 갖는 환경 레코드를 생성하고 기존의 전역 렉시컬 환경을 교체한다. 외부 렉시컬 환경에 대한 참조는 해당 블록문이 실행되기 이전의 렉시컬 환경을 가리킨다.

블록문이 종료되면 가리키고 있던 Block Lexical Environment에서 다시 전역 렉시컬 환경으로 교체한다.