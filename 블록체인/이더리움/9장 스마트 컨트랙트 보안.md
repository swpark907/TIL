스마트 컨트랙트 작성 시 보안은 가장 중요한 고려사항임.

이 분야에서 실수는 막대한 대가를 치뤄야됨.

보안 관련 모범 사례와 디자인 패턴, ‘보안 안티패턴’을 살펴보자

## 보안 모범 사례

방어적 프로그래밍 (defensive programming)에서 강조하는 것들

- 미니멀리즘/단순성 (minimalism / simplicity)
    
    코드는 단순하게, 복잡할수록 보안에 허술함
    
- 코드 재사용 (code reuse)
    
    이미 있는 것을 다시 만드느라 시간을 낭비하지 마라.
    
    반복되는 코드가 있으면 함수, 라이브러리로 작성하여 재사용 가능한 지 생각해봐라
    
- 코드 품질 (code quality)
    
    모든 버그는 금전적 손실임.
    
    코드가 배포되고 나면 문제를 해결할 방법이 거의 없다!
    
- 가독성 / 감사  용이성 (readability / auditability)
    
    코드는 명확하고 이해하기 쉬어야 한다. 읽기 쉬울수록 감사하기도 쉽다.
    
- 테스트 범위 (test coverage)
    
    할 수 있는 모든 것들을 테스트해라. 모든 인수를 테스트하여 코드 실행을 계속하기 전에 모든 인수가 예상 범위 내에 잇는지, 올바르게 형식이 지정되었는지를 확인하라
    

## 보안 위험 및 안티패턴

보안 위험, 취약성이 발생할 수 있는 사례와 예방기법에 대해 알아보자

### 재진입성

외부 호출을 공격자가 악용하는 경우

컨트랙트에 콜백을 포함하여 대체 코드를 실행하도록 강제함(폴백 함수)

### 취약점

컨트랙트가 알 수 없는 주소로 이더를 전송하는 일이 발생 가능

폴백함수에 악성 코드를 갖고 있는 컨트랙트를 외부 주소에 만들어 놓음

→ 어떤 컨트랙트에서 이 주소로 이더를 보내면 악의적인 코드가 호출

악의적 컨트랙트 → 취약한 컨트랙트의 함수 호출 → 악의적 코드 실행 경로가 그 안으로 재진입

### 예방 기법

- 이더를 외부의 컨트랙트에 보낼 때 내장된 함수를 사용
- 이더가 컨트랙트에서 전송되기 전에 상태 변수를 변경하는 모든 로직이 발생하도록 하는 것
- 뮤텍스 도입 → 코드 실행 중에 컨트랙트를 잠그는 상태 변수 추가

### 실제 사례 : DAO

### 산술 오버플로 / 언더플로

사용자 입력을 점검하지 않고 계산을 수해앟면 저장하는 데이터 유형이 범위를 벗어나 솔리디티 변수를 악용할 수 있음.

### 취약점

변수의 데이터 타입 범위를 벗어나는 숫자를 고정 크기 변수에 저장해야 하는 연산이 수행되면 오버플로 / 언더플로가 발생

ex > uint8 변수인 0 에서 1을 빼면 255가 됨 → 언더플로, 반대의 경우가 오버플로

### 예기치 않은 이더

### DELEGATECALL

### 디폴트 가시성

### 엔트로피 환상

### 외부 컨트랙트 참고

### 짧은 주소 / 파라미터 공격

### 확인되지 않은 CALL 반환

### 레이스 컨디션 / 프런트 러닝

### 서비스 거부 (DoS)

### 블록 타임스탬프 조작

### 생성자 관리

### 초기화되지 않은 스토리지 포인터

### 부동소수점 및 정밀도

### Tx.Origin 인증

### 컨트랙트 라이브러리